# openshift 4.15, 新特性

ocp 4.15 好像新特性挺多的，值得我们单开一个文档，来学习和总结一下。

# upstream k8s

- [组件版本兼容](https://kubernetes.io/releases/version-skew-policy/)
  - 这个是在升级得时候，允许不同版本的组件在一起运行，这样就可以逐步升级了。
- [Non-Graceful Node Shutdown](https://kubernetes.io/blog/2023/08/16/kubernetes-1-28-non-graceful-node-shutdown-ga/)
  - 如果一个节点异常关机，那么pod，特别是statefule pod，可以顺利的迁移到别的node
  - 之前遇到过，节点异常关机，然后pod就处于一个非常尴尬的状态，也不关闭，也不重启，一直等着节点恢复正常，所以应用就处于不能迁移，不能启动，不能维护的状态
  - 这个新的特性，可以解决这个问题，但是方法也非常愚蠢，手动设置一个节点为异常。。。
```bash
kubectl taint nodes <node-name> node.kubernetes.io/out-of-service=nodeshutdown:NoExecute
```
- [Retroactive Default StorageClass](https://kubernetes.io/blog/2023/08/18/retroactive-default-storage-class-ga/)
  - 如果pvc没有指定storageclass，那么后面定义了默认的storageclass以后，系统会自动给这些pvc定义storageclass。
- [Consistent reads from cache](https://github.com/kubernetes/enhancements/issues/2340)
  - 默认情况下，k8s api server读取到的信息，并不一致，因为cache是eventual consistent的，但是未来可以读取到一致的信息，因为cache可以设置为strongly consistent
  - ConsistentListFromCache: Allow the API server to serve consistent lists from cache.
  - 现在还是alpha，不急
- [Back off limit per index for index jobs](https://github.com/kubernetes/enhancements/issues/3850)
  - 这个东西是优化k8s本身的job的，优化的有限，是关注错误处理的。
- [Retriable and non-retriable Pod failures to fail faster](https://kubernetes.io/docs/tasks/job/pod-failure-policy/)
  - 这个还是给job用的，可见k8s原生的job功能有限。
- [Support for enabling swap space on Linux](https://kubernetes.io/blog/2023/08/24/swap-linux-beta/)
  - 原来openshift不enalbe swap是k8s的问题。


# OVN IPSec support between an OCP cluster and an external provider

- https://docs.openshift.com/container-platform/4.15/networking/ovn_kubernetes_network_provider/configuring-ipsec-ovn.html#nw-ovn-ipsec-external_configuring-ipsec-ovn
- https://issues.redhat.com/browse/RFE-3345

从帮助文档还有研发的讨论来分析，这个东西，应该是在os层面打开了一共ipsec / libreswan 的对外tunnel实现的。

# RHDE & MicroShift

- microshift有官方的方法，加入到ACM里面吗？
- microshift可以通过ipsec的方法，和别的ocp集群在ovn层面互通吗？


